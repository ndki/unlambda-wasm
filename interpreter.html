<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>
.main_container {
    display: flex;
}
.right {
    vertical-align: top;
    display: inline-block;
    font-family: sans-serif;
    font-size: 12px;
    white-space: pre-wrap;
}
</style>
<script type="module">
import { Unlambda } from "./interpreter.js";
window.onload = () => {
let parser = new Unlambda ();
const code_pad = document.getElementById('code');
const run_button = document.getElementById('run');
const stop_button = document.getElementById('stop');
const input_place = document.getElementById('input');
const status_place = document.getElementById('status');
const parse_place = document.getElementById('parse');
const executable_place = document.getElementById('executable');
const output_place = document.getElementById('output');
const error_place = document.getElementById('error');
let exec;
run_button.addEventListener('click', (e) => {
    let code_source = code_pad.value;
    status_place.innerText = '';
    parse_place.innerText = '';
    output_place.innerText = '';
    error_place.innerText = '';
    try {
        status_place.append('Parsing.. ');
        let p_t = Date.now();
        let ast = parser.parse(code_source);
        //parse_place.innerText = ''+ast;
        parse_place.innerText = 'Parsed in '+(Date.now()-p_t)/1000+'s.';
        let c_t = Date.now();
        status_place.append('Compiling.. ');
        exec = ast.compile();
        //executable_place.innerText = ''+exec;
        executable_place.innerText = 'Compiled in '+(Date.now()-c_t)/1000+'s'
            + ' to size ' + exec.states.size()+'.';
        let output = new class {
            push (arg) {
                output_place.append(arg);
            }
        }();
        let input = new class {
            next (arg) {
                //input_place.enable();
                //input_place.disable();
                let next = input_place.value[0];
                input_place.value = input_place.value.slice(1);
                return { done: !!next, value: next };
            }
        }();
        status_place.append('Running.. ');
        let r_t = Date.now();
        let results = exec.run(input, output);
        status_place.append('Done. Ran in '+(Date.now()-r_t)/1000
            +'s with ['+
            results.map(([total,size])=>'iter '+total+', size '+size).join('; ')
            +'].');
    } catch (e) {
        console.error(e);
        error_place.innerText = ''+e;
    }
});
stop_button.addEventListener('click', (e) => {
    exec.stop = true;
});
}
</script>
</head>
<body>
<div class=main_container>
<textarea id=code cols=100 rows=25></textarea>
<span class=right>
<input type=button value=run id=run
/><input type=button value=stop id=stop />
Input: <input type=text id=input />
<br>
<b>Status: </b><span id=status></span>
<b>AST: </b><span id=parse></span>
<b>ASM: </b><span id=executable></span>
<b>Out: </b><span id=output></span>
<b>Err: </b><span id=error></span>
</span>
</div>
</body>
</html>
